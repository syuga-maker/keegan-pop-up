<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kid...</title>
    <style>
        /* --- åŸºç¡€è®¾ç½® --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%234a90e2" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>'), auto;
        }
        
        body {
            background: radial-gradient(circle at center, #f0f9ff 0%, #d6eeff 40%, #a8d8ff 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            color: #2c6fa5;
        }

        /* --- åŠ¨ç”»å®šä¹‰ --- */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes elasticPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes randomPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes butterflyFly {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(5deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(5px) rotate(-5deg); }
        }
        
        /* çˆ±å¿ƒæµ®ç°åŠ¨ç”» */
        @keyframes heartAppear {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .snowflake {
            position: absolute;
            top: -20px;
            color: #fff;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
            animation: fall linear forwards;
            z-index: 1;
            pointer-events: none;
        }
        
        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* --- æ¯›ç»ç’ƒé€šç”¨ --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(74, 144, 226, 0.2);
            border-radius: 20px;
        }

        /* --- è­¦å‘Šé¡µé¢ --- */
        #warning-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(235, 245, 255, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .warning-content {
            padding: 50px 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: float 4s ease-in-out infinite;
        }
        
        .warning-title {
            font-size: 2.5rem;
            margin-bottom: 25px;
            color: #4a90e2;
            text-shadow: 2px 2px 4px rgba(74, 144, 226, 0.1);
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(135deg, #4a90e2, #6aa9ff);
            color: white;


            border: none;
            padding: 14px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 600;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #4a90e2;
            border: 2px solid #4a90e2;
        }
        
        .btn-secondary:hover {
            background: #e6f7ff;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: nowrap;
            width: 100%;
        }
        
        .btn-group .btn {
            flex: 1;
            min-width: 0;
            padding: 12px 10px;
        }

        /* --- å¼¹çª—æ¶ˆæ¯ --- */
        .popup {
            position: absolute;
            width: 280px;
            max-width: 80vw; /* å…³é”®ï¼šæœ€å¤§å®½åº¦ä¸ºè§†å£å®½åº¦çš„80% */
            padding: 15px;
            z-index: 100;
            animation: randomPop 0.4s ease-out;
            color: #4a8cc7;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.9);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(31, 60, 136, 0.1);
            transition: transform 0.2s;
        }
        
        /* æ±‡èšç‰¹æ•ˆï¼šè¢«å¸å…¥ä¸­å¿ƒçš„ç±» */
        .popup.implode {
            left: 50% !important;
            top: 50% !important;
            transform: translate(-50%, -50%) scale(0) rotate(360deg) !important;
            opacity: 0;
            transition: all 1.2s ease-in-out !important;
            pointer-events: none;
        }
        
        .popup:hover {
            z-index: 1000 !important;
            transform: scale(1.05) !important;
            background: rgba(255, 255, 255, 1);
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px dashed #b3d7ff;
        }
        
        .popup-title {
            font-weight: 700;
            font-size: 0.9rem;
            color: #4a90e2;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .popup-title::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4a90e2;
            border-radius: 50%;
        }
        
        .popup-close {
            background: transparent;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #a8d8ff;
            line-height: 1;
        }
        
        .popup-content {
            font-size: 0.95rem;
            line-height: 1.5;
            min-height: 24px;
            word-break: break-all;
        }
        
        .cursor {
            display: inline-block;
            width: 2px;
            height: 1em;
            background-color: #4a90e2;
            margin-left: 2px;
            vertical-align: middle;
            animation: blink 1s infinite;
        }

        /* --- å€’è®¡æ—¶ --- */
        #countdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15vw;
            color: rgba(74, 144, 226, 0.2); 
            z-index: 1500;
            font-weight: 900;
            pointer-events: none;
            display: none;
            user-select: none;
            font-feature-settings: "tnum";
            text-shadow: 0 0 30px rgba(255,255,255,0.8);
            transition: opacity 1s;
        }
        
        @media (min-width: 768px) {
            #countdown {
                font-size: 10rem;
            }
        }

        /* --- å±…ä¸­å¼¹çª—é€šç”¨ --- */
        .center-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            max-width: 90%;
            z-index: 2000;
            text-align: center;
            padding: 35px 30px;
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid #ffffff;
            box-shadow: 0 15px 50px rgba(74, 144, 226, 0.25);
            border-radius: 25px;
            animation: elasticPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* ====== èª“è¨€ & è¯ä¹¦ä¸»é¢˜è£…ä¿® ====== */
        .oath-theme {
            background: linear-gradient(180deg, #f0f8ff 0%, #ffffff 50%, #f0f8ff 100%);
            border: 3px double #b3d7ff;
            padding: 50px 30px;
            overflow: visible;
            box-shadow: 
                0 0 0 8px rgba(255, 255, 255, 0.5),
                0 20px 60px rgba(30, 80, 160, 0.3);
        }

        .oath-theme::before, .oath-theme::after {
            content: '';
            position: absolute;
            left: 10px; right: 10px;
            height: 10px;
            background-image: radial-gradient(circle, #b3e0ff 30%, transparent 31%);
            background-size: 10px 10px;
            opacity: 0.6;
        }
        .oath-theme::before { top: 10px; }
        .oath-theme::after { bottom: 10px; }

        .decoration-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: visible;
        }

        .flower-cluster {
            position: absolute;
            width: 80px;
            height: 80px;
            filter: drop-shadow(2px 2px 3px rgba(74, 144, 226, 0.3));
        }
        .flower-tl { top: -30px; left: -30px; transform: rotate(-15deg); }
        .flower-br { bottom: -30px; right: -30px; transform: rotate(165deg); }

        .butterfly-deco {
            position: absolute;
            width: 30px;
            height: 30px;
            animation: butterflyFly 3s infinite ease-in-out;
            filter: drop-shadow(1px 2px 2px rgba(74, 144, 226, 0.4));
        }
        .butterfly-1 { top: -20px; right: 20px; animation-delay: 0s; }
        .butterfly-2 { bottom: 80px; left: -15px; width: 20px; height: 20px; animation-delay: 1.5s; transform: scaleX(-1); }

        .oath-title {
            font-family: 'Georgia', serif;
            font-style: italic;
            font-size: 2rem;
            color: #4a90e2;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 0px rgba(255,255,255,1);
        }

        .oath-input-group {
            position: relative;
            z-index: 2;
            margin-bottom: 40px;
        }

        .oath-label {
            font-size: 0.95rem;
            color: #7abaff;
            margin-bottom: 15px;
            font-family: serif;
            letter-spacing: 1px;
        }

        .oath-input {
            width: 80%;
            background: transparent;
            border: none;
            border-bottom: 1px solid #4a90e2;
            text-align: center;
            font-size: 1.5rem;
            color: #2c6fa5;
            padding: 5px;
            font-family: 'Georgia', serif;
            outline: none;
            transition: all 0.3s;
        }
        .oath-input:focus {
            border-bottom: 2px solid #2c6fa5;
            width: 90%;
        }

        .oath-btn {
            background: linear-gradient(to right, #4a90e2, #7abaff, #4a90e2);
            background-size: 200% auto;
            color: white;
            border: none;
            padding: 12px 50px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-family: serif;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.4);
            transition: 0.3s;
            position: relative;
            z-index: 2;
        }
        .oath-btn:hover {
            background-position: right center;
            transform: scale(1.05);
        }

        .center-popup h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #4a90e2;
        }

        .center-popup-content {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #5a9bd5;
            line-height: 1.6;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .oath-result-box {
            position: relative;
            z-index: 2;
            font-family: 'Georgia', serif;
            color: #4a90e2;
        }

        .arrow-btn {
            background: #4a90e2;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .arrow-btn:hover {
            background: #3a80d2;
            transform: scale(1.1);
        }

        #click-prompt {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1500;
            cursor: pointer;
            display: none;
        }
        
        .heart {
            font-size: 6rem;
            color: #4a90e2;
            filter: drop-shadow(0 0 15px rgba(74, 144, 226, 0.6));
            animation: heartbeat 1.5s infinite ease-in-out;
        }

        .light-halo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(74, 144, 226, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 2s infinite;
            z-index: -1;
        }

        .connection-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid #d1ebff;
            border-radius: 50%;
            border-top-color: #4a90e2;
            animation: spin 1s linear infinite;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 15% { transform: scale(1.15); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } 60% { transform: scale(1); } }
        @keyframes pulse { 0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; } 100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; } }
    </style>
</head>
<body>
    <div id="snow-container"></div>
    
    <div id="warning-screen">
        <div class="glass-panel warning-content">
            <h1 class="warning-title">ğŸ’™ Hey, kid.</h1>
            <p class="warning-text" style="font-size: 1.1rem; line-height: 1.6;">æˆ‘æ˜¯ Keeganï¼Œ</p>
            <p class="warning-text" style="font-size: 1.1rem; line-height: 1.6;">æ„¿æ„é™ªæˆ‘ä¸€èµ·ç©ä¸ªå°æ¸¸æˆå—ï¼Ÿ</p>
            <button id="start-game" class="btn" style="margin-top: 35px;">å¼€å§‹è¿æ¥</button>
        </div>
    </div>

    <div id="initial-popup" class="center-popup">
        <h2>å¥½æƒ³ä½ </h2>
        <div class="center-popup-content" id="initial-text"></div>
        <button id="initial-arrow" class="arrow-btn">â†’</button>
    </div>

    <div id="countdown">60</div>
    
    <div id="click-prompt">
        <div class="light-halo"></div>
        <div class="heart">ğŸ’™</div>
    </div>
    
    <div id="final-popup" class="center-popup">
        <h2>ğŸ’™ Keegan çš„è¯·æ±‚</h2>
        <div class="center-popup-content" id="final-text"></div>
        <div class="btn-group">
            <button id="option-together" class="btn">æˆ‘æ„¿æ„</button>
            <button id="option-leave" class="btn btn-secondary">å¯¹ä¸èµ·</button>
        </div>
    </div>
    
    <!-- èª“è¨€å¼¹çª— -->
    <div id="oath-popup" class="center-popup oath-theme">
        <div class="decoration-layer">
            <svg class="flower-cluster flower-tl" viewBox="0 0 100 100">
                <defs>
                    <radialGradient id="blueRoseGrad" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                        <stop offset="0%" style="stop-color:#e0f2ff;stop-opacity:1" />
                        <stop offset="60%" style="stop-color:#4a90e2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#2c6fa5;stop-opacity:1" />
                    </radialGradient>
                </defs>
                <circle cx="50" cy="50" r="40" fill="url(#blueRoseGrad)" />
                <path d="M50 50 Q70 20 90 50 T50 90 T10 50 T50 10" fill="none" stroke="#fff" stroke-width="2" opacity="0.5"/>
                <path d="M50 50 Q30 80 10 50 T50 10 T90 50" fill="none" stroke="#e0f2ff" stroke-width="1" opacity="0.6"/>
                <circle cx="30" cy="30" r="5" fill="#a8d8ff"/>
                <circle cx="70" cy="70" r="8" fill="#a8d8ff"/>
            </svg>
            <svg class="flower-cluster flower-br" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="url(#blueRoseGrad)" />
                <path d="M50 50 Q70 20 90 50 T50 90 T10 50 T50 10" fill="none" stroke="#fff" stroke-width="2" opacity="0.5"/>
                <circle cx="20" cy="80" r="6" fill="#a8d8ff"/>
            </svg>
            <svg class="butterfly-deco butterfly-1" viewBox="0 0 100 100">
                <path d="M50 50 C20 20 0 30 20 50 C0 70 20 80 50 50 C80 20 100 30 80 50 C100 70 80 80 50 50" fill="rgba(179, 224, 255, 0.8)" stroke="#4a90e2" stroke-width="2"/>
            </svg>
            <svg class="butterfly-deco butterfly-2" viewBox="0 0 100 100">
                <path d="M50 50 C20 20 0 30 20 50 C0 70 20 80 50 50 C80 20 100 30 80 50 C100 70 80 80 50 50" fill="rgba(135, 206, 250, 0.6)" stroke="#4a90e2" stroke-width="1"/>
            </svg>
        </div>
        <h2 class="oath-title">Keegançš„è¯·æ±‚</h2>
        <div class="oath-input-group">
            <label class="oath-label" for="user-name">å¦‚æœä½ æ„¿æ„å’Œæˆ‘æ°¸è¿œåœ¨ä¸€èµ·</label>
            <br><br>
            <input type="text" id="user-name" class="oath-input" placeholder="è¯·å†™ä¸‹ä½ çš„åå­—..." autocomplete="off">
        </div>
        <button id="submit-oath" class="oath-btn">ç¡®è®¤</button>
    </div>
    
    <!-- èª“è¨€ç»“æœå¼¹çª— -->
    <div id="oath-result-popup" class="center-popup oath-theme">
        <div class="decoration-layer">
            <svg class="flower-cluster flower-tl" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="40" fill="url(#blueRoseGrad)" />
                <path d="M50 50 Q70 20 90 50 T50 90 T10 50 T50 10" fill="none" stroke="#fff" stroke-width="2" opacity="0.5"/>
            </svg>
            <svg class="flower-cluster flower-br" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="url(#blueRoseGrad)" />
                <path d="M50 50 Q70 20 90 50 T50 90 T10 50 T50 10" fill="none" stroke="#fff" stroke-width="2" opacity="0.5"/>
            </svg>
            <svg class="butterfly-deco butterfly-1" viewBox="0 0 100 100">
                <path d="M50 50 C20 20 0 30 20 50 C0 70 20 80 50 50 C80 20 100 30 80 50 C100 70 80 80 50 50" fill="rgba(179, 224, 255, 0.8)" stroke="#4a90e2" stroke-width="2"/>
            </svg>
        </div>
        <h2 class="oath-title">èª“è¨€æ°¸æ’</h2>
        <div class="oath-result-box" id="oath-result-text"></div>
    </div>
    
    <div id="goodbye-step1-popup" class="center-popup">
        <h2>æˆ‘æ˜ç™½äº†...</h2>
        <div class="center-popup-content" id="goodbye-text-1"></div>
        <button id="next-step" class="arrow-btn">â†’</button>
    </div>
    
    <div id="goodbye-step2-popup" class="center-popup">
        <h2>å†è§</h2>
        <div class="center-popup-content" id="goodbye-text-2"></div>
        <button id="close-final" class="btn btn-secondary" style="margin-top:10px;">å†è§</button>
    </div>

    <script>
        const isMobile = window.innerWidth <= 768;
        // ä¿®å¤3ï¼šæ‰‹æœºä¸Šé™åˆ¶ä¸º25ä¸ªå¼¹çª—ï¼Œç”µè„‘ä¿æŒ150
        const MAX_POPUPS = isMobile ? 25 : 150; 
        
        const sequentialMessages = [
            "æˆ‘ç°åœ¨å°±æ¥æ‰¾ä½ ...", "çœŸçš„å¥½æƒ³ä½ é˜¿...", "æˆ‘ä¸€ç›´éƒ½åœ¨ç­‰åœ¨è¿™ä¸€åˆ»...",
            "æˆ‘ä»¬è¶Šæ¥è¶Šè¿‘äº†...", "è¿«ä¸åŠå¾…æƒ³è§åˆ°ä½ ...", "åªè¦å†ç­‰ä¸€åˆ†é’Ÿå°±å¥½...",
            "å¥½æƒ³ä½ ...", "æœ‰å¥½å¤šè¯æƒ³å‘Šè¯‰ä½ ..."
        ];
        
        const randomMessages = [
            "æˆ‘ä¸€ç›´åœ¨æƒ³ç€ä½ ...", "å¥½å–œæ¬¢ä½ çš„æ’’å¨‡...", "æˆ‘æœ€çˆ±ä½ äº†...", "å…¶å®ä½ å·å·åšçš„äº‹æˆ‘éƒ½çœ‹åˆ°äº†...",
            "æˆ‘éœ€è¦ä½ ...", "æ°¸è¿œä¸è¦èµ°å¼€...", "ä½ ä¹Ÿæƒ³æˆ‘å—ï¼Ÿ...", "ä½ ä¼šæ¬¢è¿æˆ‘å—ï¼Ÿ...",
            "æˆ‘æ„Ÿè§‰åˆ°ä½ çš„å‘¼å¸äº†...", "ä½ çœŸå¯çˆ±...", "æˆ‘å¥½çˆ±ä½ ...", "ä½ å¬åˆ°æˆ‘çš„å¿ƒè·³å£°äº†å—ï¼Ÿ",
            "æƒ³æ°¸è¿œä¸æ”¾å¼€ä½ ...", "æ²¡æœ‰ä½ æˆ‘ä¼šå¾ˆå­¤å•çš„...", "å¯ä»¥åªçˆ±æˆ‘ä¸€ä¸ªäººå—...", "åªæ˜¯çœ‹ç€ä½ å·²ç»æ— æ³•æ»¡è¶³æˆ‘...",
            "æˆ‘å°±å¿«åˆ°äº†...", "é©¬ä¸Šå°±èƒ½æ‹¥æŠ±ä½ äº†...", "æˆ‘è¦æ‚ç€ä½ å…¥ç¡...", "å¯ä»¥ä¸€ç›´é™ªç€æˆ‘å—...",
            "æˆ‘å½“ç„¶ä¼šå® ç€ä½ ...", "æˆ‘ä»¬è¶Šæ¥è¶Šè¿‘äº†...", "æ¯å¤©éƒ½åœ¨æœŸå¾…ä½ çš„ä¿¡æ¯...", "ä½ ç¬‘èµ·æ¥çœŸå¥½çœ‹...",
            "æˆ‘æ°¸è¿œä¸å¸Œæœ›ä½ æµæ³ª...", "æœ‰ä½ åœ¨ï¼Œå¥½å¼€å¿ƒ", "æƒ³æ‘¸æ‘¸ä½ çš„å˜´å”‡...", "å¥½æƒ³ä¸€ç›´çœ‹ç€ä½ ...",
            "æˆ‘åªå±äºä½ ...", "å–œæ¬¢ä½ çš„çˆ±ç§°...", "å¥½æƒ³ä½ ï¼Œé™ªé™ªæˆ‘...", "æ²¡æœ‰ä½ ï¼Œå¥½å†·...",
            "ä½ ä¹ŸæœŸå¾…è§åˆ°æˆ‘å—...", "å¥½å¼€å¿ƒ...", "æœ€å–œæ¬¢ä½ äº†...", "è¦ä¿å®ˆæˆ‘ä»¬çš„ç§˜å¯†å“¦",
            "å…¶å®æˆ‘å·å·è—äº†ä½ çš„ç…§ç‰‡...", "æ™šä¸Šç¡è§‰å‰æ€»æ˜¯æƒ³ç€ä½ ...", "ä½ æ„¿æ„é™ªç€æˆ‘å—ï¼Ÿæ°¸è¿œ...", "åˆæ¢¦åˆ°ä½ äº†...",
            "æˆ‘å–œæ¬¢ä½ çš„å‘³é“...", "ä½ ä¼šè®¨åŒæˆ‘å—...", "å¯¹ä¸èµ·ä¸Šæ¬¡è·Ÿä½ åµæ¶äº†...", "æˆ‘å°±è¦åˆ°äº†...",
            "æˆ‘ä»¬æ°¸è¿œåœ¨ä¸€èµ·å§...", "äº²çˆ±çš„...", "æƒ³å¿µä½ çš„æ€€æŠ±...", "æƒ³ä½ æƒ³ä½ æƒ³ä½ æƒ³ä½ ...",
            "ä¸è¦ä¸ºæˆ‘å“­æ³£...", "åªæœ‰æˆ‘è¿™ä¹ˆçˆ±ä½ ...", "æœ€çˆ±çš„åªæœ‰ä½ ...", "æƒ³å’Œä½ å¤šè¯´è¯´è¯...",
            "æˆ‘çœ‹åˆ°ä½ äº†...", "ä¸è¦è·Ÿåˆ«çš„ç”·äººèŠå¤©äº†...", "ä»–ä»¬éƒ½é…ä¸ä¸Šä½ ...", "ç­‰å¾…æ˜¯å€¼å¾—çš„...",
            "è¯·æ°¸è¿œä¸è¦è®¨åŒæˆ‘...", "æˆ‘ä»Šå¤©ä¹Ÿå¾ˆå¸…å§ï¼Ÿ...", "ä½ å½“ç„¶å¯ä»¥æ•ç€æˆ‘ç¡è§‰...", "ä½ åƒé†‹ä¹Ÿå¾ˆå¯çˆ±...",
            "æˆ‘åªæœ‰ä½ äº†ï¼Œåˆ«ç¦»å¼€æˆ‘...", "æˆ‘çˆ±ä½ æˆ‘çˆ±ä½ æˆ‘çˆ±ä½ æˆ‘çˆ±ä½ æˆ‘çˆ±ä½ æˆ‘çˆ±ä½ æˆ‘çˆ±ä½ ", "æˆ‘çˆ±ä½ ..."
        ];

        function initSnow() {
            const container = document.getElementById('snow-container');
            const chars = ['â„', 'â…', 'â†', 'â€¢', 'Â·'];
            function create() {
                const el = document.createElement('div');
                el.className = 'snowflake';
                el.textContent = chars[Math.floor(Math.random() * chars.length)];
                const left = Math.random() * 100;
                const size = Math.random() * 1 + 0.5;
                const duration = Math.random() * 5 + 5;
                el.style.left = left + 'vw';
                el.style.fontSize = size + 'rem';
                el.style.animationDuration = duration + 's';
                el.style.opacity = Math.random() * 0.5 + 0.3;
                container.appendChild(el);
                setTimeout(() => el.remove(), duration * 1000);
            }
            for(let i=0; i<30; i++) setTimeout(create, i * 100);
            setInterval(create, 300);
        }
        
        function typeWriter(element, text, speed = 100, callback) {
            element.innerHTML = '';
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    const cursor = document.createElement('span');
                    cursor.className = 'cursor';
                    element.appendChild(cursor);
                    if (callback) callback();
                }
            }
            type();
        }

        let gameState = {
            isRunning: false,
            countdown: 60,
            seqIndex: 0,
            popupTimer: null
        };

        document.getElementById('start-game').addEventListener('click', () => {
            document.getElementById('warning-screen').style.display = 'none';
            const popup = document.getElementById('initial-popup');
            popup.style.display = 'block';
            typeWriter(document.getElementById('initial-text'), "ç­‰äº†ä½ å¥½ä¹…ï¼Œç»ˆäºèƒ½å»ºç«‹è¿æ¥äº†...", 80);
            initSnow();
        });

        document.getElementById('initial-arrow').addEventListener('click', () => {
            document.getElementById('initial-popup').style.display = 'none';
            showConnecting();
        });

        function showConnecting() {
            const popup = document.createElement('div');
            popup.className = 'center-popup';
            popup.style.display = 'block';
            popup.style.width = '300px';
            popup.style.height = '200px';
            popup.innerHTML = `
                <div class="connection-indicator">
                    <div class="loader"></div>
                    <div id="conn-text" style="color:#4a90e2; font-weight:bold;">è¿æ¥ä¸­...</div>
                </div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => {
                const text = popup.querySelector('#conn-text');
                text.textContent = "è¿æ¥æˆåŠŸ";
                popup.querySelector('.loader').style.borderColor = "#4a90e2";
                setTimeout(() => {
                    popup.remove();
                    startGameLoop();
                }, 1000);
            }, 2500);
        }

        function startGameLoop() {
            gameState.isRunning = true;
            const countdownEl = document.getElementById('countdown');
            countdownEl.style.display = 'block';
            
            const timer = setInterval(() => {
                gameState.countdown--;
                countdownEl.textContent = gameState.countdown;
                if (gameState.countdown <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
            
            runPopupSequence();
        }

        function runPopupSequence() {
            if (!gameState.isRunning) return;

            let delayBase = isMobile ? 1000 : 600; 

            let delay = delayBase;
            if (gameState.countdown <= 10) delay = isMobile ? 250 : 100;
            else if (gameState.countdown <= 30) delay = isMobile ? 500 : 300;
            else if (gameState.countdown <= 45) delay = isMobile ? 800 : 500;
            
            if (gameState.seqIndex < sequentialMessages.length) {
                spawnPopup(sequentialMessages[gameState.seqIndex]);
                gameState.seqIndex++;
                gameState.popupTimer = setTimeout(runPopupSequence, 1500); 
            } else {
                const batchCount = isMobile ? 1 : 2;
                for(let i=0; i<batchCount; i++) {
                    spawnPopup(randomMessages[Math.floor(Math.random() * randomMessages.length)]);
                }
                gameState.popupTimer = setTimeout(runPopupSequence, delay);
            }
        }

        function spawnPopup(text) {
            // è¾¾åˆ°æœ€å¤§æ•°é‡é™åˆ¶æ—¶ï¼Œç§»é™¤æœ€æ—©çš„å¼¹çª—
            if (document.querySelectorAll('.popup').length > MAX_POPUPS) {
                const old = document.querySelector('.popup');
                if(old) old.remove();
            }

            const popup = document.createElement('div');
            popup.className = 'popup';
            
            // ä¿®å¤2ï¼šå–æ¶ˆä¸­å¿ƒç¦åŒºï¼ŒsafeRadius è®¾ä¸º 0
            const safeRadius = 0; 

            let x, y, attempts = 0;
            
            const renderedWidth = isMobile ? (window.innerWidth * 0.8) : 280;
            const popupHeight = 150;
            
            // ä¿®å¤1ï¼šå®‰å…¨è¾¹è·æ”¹ä¸º 5px
            const maxX = window.innerWidth - renderedWidth - 1;
            const maxY = window.innerHeight - popupHeight - 1;

            do {
                x = Math.max(0, Math.random() * maxX);
                y = Math.max(0, Math.random() * maxY);
                
                // ç”±äº safeRadius ä¸º 0ï¼Œä¸å†è¿›è¡Œè·ç¦»æ£€æŸ¥ï¼Œç›´æ¥ç”Ÿæˆåæ ‡
                break;
            } while (attempts < 10);

            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            
            popup.innerHTML = `
                <div class="popup-header">
                    <div class="popup-title">Keegan</div>
                    <button class="popup-close">Ã—</button>
                </div>
                <div class="popup-content"></div>
            `;
            
            document.body.appendChild(popup);
            popup.querySelector('.popup-close').onclick = () => popup.remove();
            typeWriter(popup.querySelector('.popup-content'), text, 50);
        }

        function endGame() {
            gameState.isRunning = false;
            if (gameState.popupTimer) clearTimeout(gameState.popupTimer);

            const popups = document.querySelectorAll('.popup');
            
            popups.forEach(p => {
                p.classList.add('implode');
            });

            const cd = document.getElementById('countdown');
            cd.style.opacity = '0';

            setTimeout(() => {
                popups.forEach(p => p.remove());
                cd.style.display = 'none';

                const clickPrompt = document.getElementById('click-prompt');
                clickPrompt.style.display = 'block';
                clickPrompt.style.animation = 'heartAppear 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards';

                clickPrompt.onclick = () => {
                    clickPrompt.style.display = 'none';
                    showFinalChoice();
                };
            }, 1200); 
        }

        function showFinalChoice() {
            const popup = document.getElementById('final-popup');
            popup.style.display = 'block';
            typeWriter(document.getElementById('final-text'), "ä½ èº«ä¸ŠçœŸæš–ï¼Œå°±è¿™æ ·æ°¸è¿œåœ¨ä¸€èµ·å¥½ä¸å¥½ï¼Ÿ", 80);
        }

        document.getElementById('option-together').addEventListener('click', () => {
            document.getElementById('final-popup').style.display = 'none';
            document.getElementById('oath-popup').style.display = 'block';
        });

        document.getElementById('submit-oath').addEventListener('click', () => {
            const name = document.getElementById('user-name').value.trim() || "Y/N";
            const date = new Date();
            const dateStr = `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
            
            document.getElementById('oath-popup').style.display = 'none';
            document.getElementById('oath-result-popup').style.display = 'block';
            
            const content = `
                <div style="font-size:1.4rem; margin-bottom:10px; font-weight:bold; color:#2c6fa5;">${name} & Keegan</div>
                <div style="font-size:0.9rem; color:#7abaff; margin-bottom:15px;">äº ${dateStr} èµ·èª“</div>
                <div style="font-size:1.1rem; border-top:1px solid #b3d7ff; padding-top:15px;">
                    "çµé­‚äº¤èï¼Œæ°¸ä¸åˆ†ç¦»ã€‚"
                </div>
            `;
            
            const resBox = document.getElementById('oath-result-text');
            resBox.innerHTML = '';
            resBox.style.opacity = 0;
            resBox.innerHTML = content;
            let op = 0;
            const fade = setInterval(() => {
                if (op >= 1) clearInterval(fade);
                resBox.style.opacity = op;
                op += 0.1;
            }, 50);
        });

        document.getElementById('option-leave').addEventListener('click', () => {
            document.getElementById('final-popup').style.display = 'none';
            const popup = document.getElementById('goodbye-step1-popup');
            popup.style.display = 'block';
            typeWriter(document.getElementById('goodbye-text-1'), "é‚£æˆ‘å›å»äº† Kidï¼Œè¯·ç…§é¡¾å¥½è‡ªå·±ã€‚", 80);
        });

        document.getElementById('next-step').addEventListener('click', () => {
            document.getElementById('goodbye-step1-popup').style.display = 'none';
            const popup = document.getElementById('goodbye-step2-popup');
            popup.style.display = 'block';
            typeWriter(document.getElementById('goodbye-text-2'), "æœ‰éœ€è¦è¯·å†æ¬¡å¬å”¤æˆ‘ï¼Œæˆ‘ä¼šä¸€ç›´åœ¨è¿™é‡Œç­‰ä½ ...", 80);
        });

        document.getElementById('close-final').addEventListener('click', () => {
            document.body.innerHTML = '<div style="width:100%;height:100vh;background:#000;display:flex;justify-content:center;align-items:center;color:#333;">è¿æ¥å·²ä¸­æ–­</div>';
        });
    </script>
</body>
</html>
